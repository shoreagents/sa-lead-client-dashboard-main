generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public"]
}

model User {
  id                  String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id             String             @unique @map("user_id") @db.VarChar(255)
  first_name          String?            @map("first_name") @db.VarChar(100)
  last_name           String?            @map("last_name") @db.VarChar(100)
  company             String?            @db.VarChar(200)
  email               String?            @db.VarChar(255)
  phone_number        String?            @map("phone_number") @db.VarChar(20)
  country             String?            @db.VarChar(100)
  created_at          DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at          DateTime?          @default(now()) @map("updated_at") @db.Timestamptz(6)
  auth_user_id        String?            @map("auth_user_id") @db.Uuid
  user_type           UserType           @default(Anonymous) @map("user_type")
  industry_name       String?            @map("industry_name") @db.VarChar(200)
  first_lead_capture  Boolean?           @default(false) @map("first_lead_capture")
  second_lead_capture Boolean?           @default(false) @map("second_lead_capture")
  third_lead_capture  Boolean?           @default(false) @map("third_lead_capture")
  desired_team_size   Int?
  candidateViews      CandidateView[]    @relation("UserCandidateViews")
  interviewRequests   InterviewRequest[] @relation("UserInterviewRequests")
  leadProgress        LeadProgress?      @relation("UserLeadProgress")
  pricingQuotes       PricingQuote[]     @relation("UserPricingQuotes")
  enrichment          UserEnrichment?    @relation("UserEnrichmentData")

  @@index([company], map: "idx_users_company")
  @@index([country], map: "idx_users_country")
  @@index([email], map: "idx_users_email")
  @@index([first_lead_capture], map: "idx_users_first_lead_capture")
  @@index([industry_name], map: "idx_users_industry_name")
  @@index([second_lead_capture], map: "idx_users_second_lead_capture")
  @@index([third_lead_capture], map: "idx_users_third_lead_capture")
  @@index([user_id], map: "idx_users_user_id")
  @@index([desired_team_size], map: "idx_users_desired_team_size")
  @@map("users")
  @@schema("public")
}

model PricingQuote {
  id                        String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                   String             @map("user_id")
  session_id                String?            @map("session_id")
  quote_timestamp           DateTime           @default(now()) @map("quote_timestamp") @db.Timestamptz(6)
  member_count              Int                @map("member_count")
  industry                  String
  total_monthly_cost        Decimal            @map("total_monthly_cost") @db.Decimal(10, 2)
  currency_code             String             @default("PHP") @map("currency_code") @db.VarChar(3)
  created_at                DateTime           @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at                DateTime           @default(now()) @map("updated_at") @db.Timestamptz(6)
  quote_number              Int                @default(1) @map("quote_number")
  candidate_recommendations Json?              @default("[]") @map("candidate_recommendations")
  pricingQuoteRoles         PricingQuoteRole[]
  user                      User               @relation("UserPricingQuotes", fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_pricing_quotes_user_id")

  @@index([candidate_recommendations], map: "idx_pricing_quotes_candidate_recommendations", type: Gin)
  @@index([industry], map: "idx_pricing_quotes_industry")
  @@index([user_id, quote_number], map: "idx_pricing_quotes_quote_number")
  @@index([user_id], map: "idx_pricing_quotes_user_id")
  @@map("pricing_quotes")
  @@schema("public")
}

model CandidateView {
  id                Int       @id @default(autoincrement())
  user_id           String    @map("user_id") @db.VarChar(255)
  candidate_id      String    @map("candidate_id") @db.VarChar(255)
  candidate_name    String?   @map("candidate_name") @db.VarChar(255)
  view_duration     Int?      @map("view_duration")
  page_views        Int?      @default(1) @map("page_views")
  created_at        DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at        DateTime? @default(now()) @map("updated_at") @db.Timestamptz(6)
  scroll_percentage Int?      @default(0) @map("scroll_percentage")
  user              User      @relation("UserCandidateViews", fields: [user_id], references: [user_id], onDelete: Cascade)

  @@unique([user_id, candidate_id], map: "unique_user_candidate")
  @@index([candidate_id, created_at], map: "idx_candidate_views_candidate_created")
  @@index([candidate_id], map: "idx_candidate_views_candidate_id")
  @@index([candidate_name], map: "idx_candidate_views_candidate_name")
  @@index([created_at], map: "idx_candidate_views_created_at")
  @@index([scroll_percentage], map: "idx_candidate_views_scroll_percentage")
  @@index([user_id, created_at], map: "idx_candidate_views_user_created")
  @@index([user_id], map: "idx_candidate_views_user_id")
  @@map("candidate_views")
  @@schema("public")
}

model InterviewRequest {
  id                   Int      @id @default(autoincrement())
  user_id              String   @map("user_id") @db.VarChar(255)
  candidate_id         String   @map("candidate_id") @db.VarChar(255)
  candidate_name       String   @map("candidate_name") @db.VarChar(255)
  candidate_position   String?  @map("candidate_position") @db.VarChar(255)
  requester_first_name String   @map("requester_first_name") @db.VarChar(100)
  requester_last_name  String   @map("requester_last_name") @db.VarChar(100)
  requester_email      String   @map("requester_email") @db.VarChar(255)
  created_at           DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at           DateTime @default(now()) @map("updated_at") @db.Timestamptz(6)
  user                 User     @relation("UserInterviewRequests", fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([candidate_id], map: "idx_interview_request_candidate_id")
  @@index([created_at], map: "idx_interview_request_created_at")
  @@index([user_id], map: "idx_interview_request_user_id")
  @@map("interview_request")
  @@schema("public")
}

model PricingQuoteRole {
  id               String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  quote_id         String       @map("quote_id") @db.Uuid
  role_title       String       @map("role_title")
  role_description String?      @map("role_description")
  experience_level String       @map("experience_level")
  workspace_type   String       @map("workspace_type")
  base_salary_php  Decimal      @map("base_salary_php") @db.Decimal(10, 2)
  multiplier       Decimal      @db.Decimal(3, 2)
  monthly_cost     Decimal      @map("monthly_cost") @db.Decimal(10, 2)
  workspace_cost   Decimal      @map("workspace_cost") @db.Decimal(10, 2)
  total_cost       Decimal      @map("total_cost") @db.Decimal(10, 2)
  created_at       DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at       DateTime     @default(now()) @map("updated_at") @db.Timestamptz(6)
  pricingQuote     PricingQuote @relation(fields: [quote_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_pricing_quote_roles_quote_id")

  @@index([quote_id], map: "idx_pricing_quote_roles_quote_id")
  @@map("pricing_quote_roles")
  @@schema("public")
}

model UserPageVisit {
  id                   String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id              String    @map("user_id")
  page_path            String    @map("page_path")
  ip_address           String?   @map("ip_address")
  visit_timestamp      DateTime  @default(now()) @map("visit_timestamp") @db.Timestamptz(6)
  created_at           DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  visit_count          Int?      @default(1) @map("visit_count")
  time_spent_seconds   Int?      @default(0) @map("time_spent_seconds")
  last_visit_timestamp DateTime? @default(now()) @map("last_visit_timestamp") @db.Timestamptz(6)

  @@map("user_page_visits")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model content_views {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id          String?   @db.VarChar(255)
  content_type     String    @db.VarChar(50)
  content_id       String    @db.VarChar(255)
  content_title    String?   @db.VarChar(500)
  content_url      String?
  page_section     String?   @db.VarChar(100)
  referrer_url     String?
  referrer_type    String?   @db.VarChar(50)
  view_duration    Int?
  scroll_depth     Int?
  viewed_at        DateTime? @default(now()) @db.Timestamptz(6)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  interaction_type String?   @default("view") @db.VarChar(50)
  activity_count   Int?      @default(1)

  @@index([activity_count], map: "idx_content_views_activity_count")
  @@index([content_type, content_id, viewed_at], map: "idx_content_views_content_analytics")
  @@index([content_id], map: "idx_content_views_content_id")
  @@index([content_type], map: "idx_content_views_content_type")
  @@index([content_type, content_id, interaction_type], map: "idx_content_views_interaction_analytics")
  @@index([interaction_type], map: "idx_content_views_interaction_type")
  @@index([referrer_type], map: "idx_content_views_referrer_type")
  @@index([user_id, viewed_at], map: "idx_content_views_user_analytics")
  @@index([user_id], map: "idx_content_views_user_id")
  @@index([viewed_at], map: "idx_content_views_viewed_at")
  @@schema("public")
}

model LeadProgress {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id         String   @unique @map("user_id") @db.VarChar(255)
  status          String   @map("status") @db.VarChar(50)
  previous_status String?  @map("previous_status") @db.VarChar(50)
  changed_by      String?  @map("changed_by") @db.VarChar(255)
  change_reason   String?  @map("change_reason") @db.VarChar(500)
  created_at      DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  notes           String?  @map("notes")
  user            User     @relation("UserLeadProgress", fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([status], map: "idx_lead_progress_status")
  @@index([changed_by], map: "idx_lead_progress_changed_by")
  @@map("lead_progress")
  @@schema("public")
}

model UserEnrichment {
  id                   String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id              String   @unique @map("user_id") @db.VarChar(255)
  full_name            String?  @map("full_name") @db.VarChar(255)
  job_title            String?  @map("job_title") @db.VarChar(255)
  location             String?  @map("location") @db.VarChar(255)
  bio                  String?  @map("bio")
  company_name         String?  @map("company_name") @db.VarChar(255)
  company_website      String?  @map("company_website") @db.VarChar(500)
  company_domain       String?  @map("company_domain") @db.VarChar(255)
  company_industry     String?  @map("company_industry") @db.VarChar(255)
  company_size         String?  @map("company_size") @db.VarChar(100)
  company_founded      String?  @map("company_founded") @db.VarChar(50)
  company_description  String?  @map("company_description")
  company_headquarters String?  @map("company_headquarters") @db.VarChar(255)
  linkedin_url         String?  @map("linkedin_url") @db.VarChar(500)
  twitter_url          String?  @map("twitter_url") @db.VarChar(500)
  facebook_url         String?  @map("facebook_url") @db.VarChar(500)
  phone_number         String?  @map("phone_number") @db.VarChar(50)
  additional_emails    String?  @map("additional_emails")
  search_results       String?  @map("search_results")
  search_query         String?  @map("search_query") @db.VarChar(500)
  enriched_by          String?  @map("enriched_by") @db.VarChar(255)
  enrichment_source    String   @default("serper_api") @map("enrichment_source") @db.VarChar(50)
  confidence_score     Int?     @map("confidence_score")
  created_at           DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at           DateTime @default(now()) @map("updated_at") @db.Timestamptz(6)
  company_logo_url     String?  @map("company_logo_url") @db.VarChar(1000)
  profile_picture_url  String?  @map("profile_picture_url") @db.VarChar(1000)
  user                 User     @relation("UserEnrichmentData", fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_user_enrichment_user_id")
  @@index([company_name], map: "idx_user_enrichment_company")
  @@index([enriched_by], map: "idx_user_enrichment_enriched_by")
  @@map("user_enrichment")
  @@schema("public")
}

model Conversation {
  id                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id             String               @map("user_id") @db.VarChar(255)
  conversation_type   ConversationType     @default(Anonymous) @map("conversation_type")
  title               String?              @db.VarChar(255)
  context_data        Json?                @map("context_data")
  created_at          DateTime             @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at          DateTime             @default(now()) @map("updated_at") @db.Timestamptz(6)
  migrated_at         DateTime?            @map("migrated_at") @db.Timestamptz(6)
  conversation_memory ConversationMemory[]
  messages            Message[]

  @@index([user_id], map: "idx_conversations_user_id")
  @@index([conversation_type], map: "idx_conversations_type")
  @@index([created_at], map: "idx_conversations_created_at")
  @@index([migrated_at], map: "idx_conversations_migrated_at")
  @@map("conversations")
  @@schema("public")
}

model Message {
  id               String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  conversation_id  String       @map("conversation_id") @db.Uuid
  user_id          String       @map("user_id") @db.VarChar(255)
  role             MessageRole  @default(User)
  content          String
  context_snapshot Json?        @map("context_snapshot")
  created_at       DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  conversation     Conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([conversation_id], map: "idx_messages_conversation_id")
  @@index([user_id], map: "idx_messages_user_id")
  @@index([created_at], map: "idx_messages_created_at")
  @@map("messages")
  @@schema("public")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model KnowledgeEmbedding {
  id         String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  content    String
  title      String?
  url        String?
  embedding  Unsupported("vector")?
  metadata   Json?
  created_at DateTime?              @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at DateTime?              @default(now()) @map("updated_at") @db.Timestamptz(6)

  @@index([embedding])
  @@map("knowledge_embeddings")
  @@schema("public")
}

model ConversationMemory {
  id               String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id          String                 @map("user_id")
  conversation_id  String?                @map("conversation_id") @db.Uuid
  memory_type      String                 @map("memory_type")
  content          Json
  embedding        Unsupported("vector")?
  importance_score Int?                   @default(5) @map("importance_score")
  created_at       DateTime?              @default(now()) @map("created_at") @db.Timestamptz(6)
  expires_at       DateTime?              @map("expires_at") @db.Timestamptz(6)
  metadata         Json?
  conversations    Conversation?          @relation(fields: [conversation_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "conversation_memory_user_idx")
  @@index([conversation_id], map: "conversation_memory_conversation_idx")
  @@index([memory_type], map: "conversation_memory_type_idx")
  @@index([importance_score(sort: Desc)], map: "conversation_memory_importance_idx")
  @@index([embedding])
  @@map("conversation_memory")
  @@schema("public")
}

model ContentEmbedding {
  id                   String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  content_id           String                 @unique @map("content_id") @db.VarChar(255)
  content_type         String                 @map("content_type") @db.VarChar(50)
  title                String
  description          String?
  full_content         String?                @map("full_content")
  url_path             String                 @map("url_path") @db.VarChar(500)
  embedding            Unsupported("vector")?
  metadata             Json?                  @default("{}")
  semantic_categories  String[]               @default([]) @map("semantic_categories")
  view_count           Int?                   @default(0) @map("view_count")
  recommendation_count Int?                   @default(0) @map("recommendation_count")
  created_at           DateTime?              @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at           DateTime?              @default(now()) @map("updated_at") @db.Timestamptz(6)

  @@index([content_type])
  @@index([content_id])
  @@index([url_path])
  @@index([embedding])
  @@index([semantic_categories], map: "content_embeddings_categories_idx", type: Gin)
  @@map("content_embeddings")
  @@schema("public")
}

enum UserType {
  Anonymous
  Regular
  Admin

  @@map("user_type_enum")
  @@schema("public")
}

enum ConversationType {
  Anonymous
  Authenticated

  @@map("conversation_type_enum")
  @@schema("public")
}

enum MessageRole {
  User
  Assistant

  @@map("message_role_enum")
  @@schema("public")
}
